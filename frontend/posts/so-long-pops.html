<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>So Long Pops</title>
  <style>
    body {
      font-family: 'Montserrat', sans-serif;
      background-color: rgb(249, 251, 231);
      color: #333;
      max-width: 800px;
      margin: auto;
      padding: 2rem;
      text-align: center;
    }
    h1, h2 {
      color: #222;
    }
    img {
      max-width: 100%;
      height: auto;
    }
    blockquote {
      border-left: 4px solid #888;
      margin-left: 0;
      padding-left: 1rem;
      font-style: italic;
      color: #555;
    }
    .footer {
      margin-top: 3rem;
      font-size: 0.9rem;
      color: #777;
      text-align: center;
    }
    button.like-btn {
      background-color: #eee;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      padding: 6px 12px;
      margin-top: 5px;
      font-family: 'Montserrat', sans-serif;
    }
    #authStatus {
      margin-bottom: 1rem;
      font-weight: bold;
    }
    #loginBtn, #logoutBtn {
      background-color: #2ECC71;
      color: white;
      border: none;
      padding: 6px 14px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      margin: 0 5px;
      font-family: 'Montserrat', sans-serif;
    }
    textarea {
      width: 100%;
      height: 80px;
      padding: 8px;
      margin: 10px 0;
      font-family: 'Montserrat', sans-serif;
      font-size: 1rem;
      resize: vertical;
    }
    input[type="text"] {
      width: 100%;
      padding: 8px;
      font-family: 'Montserrat', sans-serif;
      font-size: 1rem;
      margin: 10px 0;
    }
    #commentsList > div {
      text-align: left;
    }
  </style>
  <script src="./notifications.js"></script>
</head>

<body>
  <!-- Firebase SDKs: include these ONCE per page -->
<script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-database-compat.js"></script>

<!-- Your config and presence scripts -->
<script src="/path/to/firebase-config.js"></script>
<script src="/path/to/presence.js"></script>

  <h1>So Long Pops</h1>
  <p>By: <a href="smayan.html">Smayan Srikanth</a></p>
  <a href="../index.html">Home</a>

  <div id="authStatus">Loading authentication status...</div>
  <button id="loginBtn" style="display: inline-block;">Login / Signup</button>
  <button id="logoutBtn" style="display: none;">Logout</button>

  <button class="like-btn" id="likeArticleBtn">❤️ Like Article (<span id="articleLikes">0</span>)</button>

  <hr style="border: 1px solid black; margin: 20px 0;" />
  <p><strong>Gregg Popovich Day</strong></p>
  <p><strong>That’s what January 28th should be, every single year.</strong></p>

  <p>Thanks for reading Sports Square! Subscribe for free to receive new posts and support my work.</p>
  <form action="https://formsubmit.co/sportssquareauthor@gmail.com" method="POST" style="margin-bottom: 3rem;">
    <input
      type="email"
      name="email"
      placeholder="Your email"
      required
      style="width: 300px; padding: 10px; margin-bottom: 10px;"
    />
    <input type="hidden" name="_next" value="https://sportssquare.netlify.app/subscribed.html" />
    <input type="hidden" name="_captcha" value="false" />
    <input type="hidden" name="_subject" value="New subscription from Sports Square" />
    <input type="hidden" name="_message" value="A new user has subscribed to Sports Square." />
    <br />
    <button
      type="submit"
      style="
        width: 120px;
        height: 50px;
        background-color: #2ecc71;
        color: white;
        padding: 10px 20px;
        font-size: 16px;
        font-weight: bold;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-family: 'Montserrat', sans-serif;
      "
    >
      Subscribe
    </button>
  </form>

  <h2>Origins</h2>
  <p>
    The Popovich story began on that date in 1949, in bustling East Chicago, Indiana, home to the Indiana Harbor
    and the Ship Canal. He was born to a Serbian father and a Croatian mother, graduating from Merrillville High School
    in 1966.
  </p>

  <p>
    He then attended the United States Air Force Academy, playing on the academy’s Air Force Falcons basketball team. In
    his senior year, he even became the team captain and was the leading scorer that year. He graduated in 1970 and
    considered a career with the CIA.
  </p>

  <p>
    Pops then served in the US Air Force. During this time, he continued playing with the US Armed Forces basketball team,
    becoming captain and winning the AAU championship. He was then invited to the 1972 US Olympic Trials — but was cut from
    the team.
  </p>

  <h2>Early Coaching</h2>
  <p>
    Popovich began his coaching career as an assistant coach to Hank Egan at the Air Force Academy. During this time, he
    earned a master’s degree in physical education and sports sciences from the University of Denver.
  </p>

  <p>
    He worked there for 6 years (1973–1979), before moving to the Pomona-Pitzer Sagehens in Claremont, California — a small
    DIII program. According to Popovich, he didn’t know the program was in rough shape. In 1980, he was just another coach
    trying to figure it out.
  </p>

  <blockquote>
    “It was a horrendous beginning,” Popovich recalled, “But be that as it may, I still fell in love with it.”
  </blockquote>

  <p><em>Popovich with Pomona-Pitzer. Courtesy: Peter Osgood.</em></p>
  <img src="../image.png" alt="Popovich with Pomona-Pitzer" />

  <p>
    That first year, the Hens lost to Caltech, breaking their 99-game conference losing streak. But Popovich kept going,
    sending thousands of recruiting letters nationwide. His assistant Charles Katsiaficas recalled the grind:
  </p>

  <blockquote>
    “A lot of letter-writing, a lot of follow-up calls...you really had to work very hard at generating a recruiting list.”
  </blockquote>

  <p>Five seasons after a 2-22 season, the Sagehens were SCIAC champions. They lost in the first round, but they won the conference.</p>

  <h2>Climbing to the NBA</h2>
  <p>
    Popovich volunteered under Larry Brown at Kansas, then returned to Pomona. By 1988, he joined Brown in the NBA as a Spurs
    assistant, until 1992. He later served under Don Nelson at the Warriors, which Pop said helped him grow immensely.
  </p>

  <p>
    He returned to San Antonio in 1994 as GM, signing Avery Johnson and trading Dennis Rodman. After a rough 3-15 start in
    1996, Popovich fired head coach Bob Hill and took over himself on December 10.
  </p>

  <p>That poor season earned the Spurs the #1 draft pick, selecting Tim Duncan — changing the franchise forever.</p>

  <h2>The Spurs Dynasty</h2>
  <p>
    With David Robinson and Tim Duncan, Popovich led the Spurs to 56 wins in 1997–98 and their first NBA title in 1999. Over
    the next 20 years, he would win five championships (1999, 2003, 2005, 2007, and 2014), and three Coach of the Year awards.
  </p>

  <p>
    Pop was never afraid to make unpopular decisions — like resting stars and getting fined for it — to protect his players’
    longevity. His vision went beyond basketball.
  </p>

  <blockquote>
    “This is probably the most meaningful of any award I've received... this place molded me from a wise guy to a half decent
    person.”
    <br />
    – Gregg Popovich on becoming an Air Force Distinguished Graduate
  </blockquote>

  <h2>The Final Years</h2>
  <p>
    In 2021, Popovich coached Team USA to Olympic Gold. In 2022, he became the all-time regular season wins leader. In 2023,
    he entered the Basketball Hall of Fame. And on November 2, 2024, Popovich suffered a stroke — his final game as coach
    was against the Timberwolves.
  </p>

  <p>
    He stepped down in 2025, ending a 29-year head-coaching reign, but continued as President of Basketball Operations.
  </p>

  <h2>Legacy and Impact</h2>
  <p>
    From Shaq to Steve Kerr, Pop’s impact is universally respected. He treated every player the same. He stood for
    discipline, equality, humility, and honesty.
  </p>

  <blockquote>
    “We used to call it ‘The Program.’ I love that man for a different reason... Pop gave us a couple pairs of shoes. He
    never wanted anything in return.”
    <br />
    – Shaquille O’Neal
  </blockquote>

  <blockquote>
    “Pop is one of the most important people in my life... for reasons that go way beyond basketball.”
    <br />
    – Steve Kerr
  </blockquote>

  <p>
    He held players accountable — even legends like Tim Duncan — and inspired everyone in his orbit. He revolutionized the
    way coaching is viewed in the NBA.
  </p>

  <h2>Forever Coach Pops</h2>
  <p>I didn’t expect to publish this article so soon — maybe in 2028. But Pops deserves this. Forever.</p>

  <h3>Because</h3>
  <h3>That’s</h3>
  <h3>The</h3>
  <h3>Coach</h3>
  <h3>Pops</h3>
  <h3>Way.</h3>
  <hr style="border: 1px solid black; margin: 40px 0;" />
  <div id="comments-section">
    <h2>Comments</h2>
    <form id="commentForm">
      <input type="text" id="name" placeholder="Your name (anonymous allowed)" required /><br />
      <textarea id="comment" placeholder="Your comment" required></textarea><br />
      <button type="submit">Post Comment</button>
    </form>
    <div id="commentsList">Loading...</div>
  </div>

  <div
    id="rate-me"
    style="
      font-family: Arial, sans-serif;
      margin: 50px auto;
      text-align: center;
      padding: 20px;
      border: 2px solid #ccc;
      border-radius: 10px;
      background-color: #f9f9f9;
      max-width: 400px;
    "
  >
    <label style="font-weight: bold;">Rate The Article:</label>
    <br />
    <div
      id="stars-container"
      class="stars"
      style="display: flex; justify-content: center; cursor: pointer; font-size: 3rem; color: lightgray; text-align: center;"
    >
      <span class="star" data-value="1" style="margin-right: 10px;">★</span>
      <span class="star" data-value="2" style="margin-right: 10px;">★</span>
      <span class="star" data-value="3" style="margin-right: 10px;">★</span>
      <span class="star" data-value="4" style="margin-right: 10px;">★</span>
      <span class="star" data-value="5">★</span>
    </div>
    <p id="rating-result" style="font-size: 1.2rem; font-weight: bold;"></p>
  </div>

  <div class="footer">
    <p>© 2025 Sports Square. All rights reserved.</p>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <script>
    // IMPORTANT: This Firebase config is now set to sportssquare-b96ed.
    // This must match the configuration in your signup.html file for consistent authentication.
    const firebaseConfig = {
      apiKey: "AIzaSyC-p_D5KgLbpMm_5REwdDaaq-YBrE3pwkk",
      authDomain: "sportssquare-b96ed.firebaseapp.com",
      projectId: "sportssquare-b96ed",
      storageBucket: "sportssquare-b96ed.firebasestorage.app",
      messagingSenderId: "844736978057",
      appId: "1:844736978057:web:76c8db520d3c27bdeb7a58"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const authStatus = document.getElementById("authStatus");
    const loginBtn = document.getElementById("loginBtn");
    const logoutBtn = document.getElementById("logoutBtn");
    const articleLikesSpan = document.getElementById("articleLikes");
    const likeArticleBtn = document.getElementById("likeArticleBtn");
    const commentsList = document.getElementById("commentsList");
    const commentForm = document.getElementById("commentForm");
    const starsContainer = document.getElementById("stars-container");
    const ratingResult = document.getElementById("rating-result");

    let currentUser = null;

    function escapeHtml(text) {
      const div = document.createElement("div");
      div.textContent = text;
      return div.innerHTML;
    }

    auth.onAuthStateChanged(async (user) => {
      currentUser = user;
      if (user) {
        authStatus.textContent = `Welcome, ${user.email}`;
        loginBtn.style.display = "none";
        logoutBtn.style.display = "inline-block";
      } else {
        authStatus.textContent = "You are not logged in.";
        loginBtn.style.display = "inline-block";
        logoutBtn.style.display = "none";
      }
      await loadArticleLikes();
      await loadComments();
      await loadUserRating();
    });

    loginBtn.onclick = () => {
      // Pass the current article URL as a redirect parameter
      window.location.href = `../signup.html?redirect=${encodeURIComponent(window.location.href)}`;
    };

    logoutBtn.onclick = () => {
      auth.signOut();
    };

    async function loadArticleLikes() {
      try {
        const doc = await db.collection("likes").doc("article").get();
        const likesCount = doc.exists && doc.data().count ? doc.data().count : 0;
        articleLikesSpan.textContent = likesCount;
      } catch (error) {
        console.error("Failed to load article likes:", error);
      }
    }

    likeArticleBtn.onclick = async () => {
      if (!currentUser) {
        // Using a custom message box instead of alert()
        showMessageBox("You need to be logged in to like the article.");
        return;
      }
      try {
        const userLikeDoc = await db
          .collection("likes")
          .doc("articleLikesUsers")
          .collection("users")
          .doc(currentUser.uid)
          .get();

        if (userLikeDoc.exists) {
          showMessageBox("You already liked this article!");
          return;
        }

        await db
          .collection("likes")
          .doc("articleLikesUsers")
          .collection("users")
          .doc(currentUser.uid)
          .set({ liked: true });

        const articleLikesRef = db.collection("likes").doc("article");
        await db.runTransaction(async (transaction) => {
          const doc = await transaction.get(articleLikesRef);
          if (!doc.exists) {
            transaction.set(articleLikesRef, { count: 1 });
          } else {
            const newCount = (doc.data().count || 0) + 1;
            transaction.update(articleLikesRef, { count: newCount });
          }
        });

        await loadArticleLikes();
      } catch (error) {
        console.error("Error liking article:", error);
        showMessageBox("Failed to like the article. Please try again.");
      }
    };

    async function loadComments() {
      try {
        const snapshot = await db.collection("comments").orderBy("timestamp", "desc").get();
        commentsList.innerHTML = "";
        if (snapshot.empty) {
          commentsList.textContent = "No comments yet. Be the first!";
          return;
        }
        snapshot.forEach((doc) => {
          const data = doc.data();
          const commentDiv = document.createElement("div");
          commentDiv.style.borderBottom = "1px solid #ddd";
          commentDiv.style.padding = "10px 0";

          const commentId = doc.id;

          const commentLikeBtn = document.createElement("button");
          commentLikeBtn.className = "like-btn";
          commentLikeBtn.textContent = `❤️ Like Comment (0)`;
          commentLikeBtn.style.marginTop = "5px";

          commentLikeBtn.onclick = async () => {
            if (!currentUser) {
              showMessageBox("You need to be logged in to like comments.");
              return;
            }
            try {
              const userCommentLikeDoc = await db
                .collection("commentLikes")
                .doc(commentId)
                .collection("users")
                .doc(currentUser.uid)
                .get();

              if (userCommentLikeDoc.exists) {
                showMessageBox("You already liked this comment!");
                return;
              }

              await db
                .collection("commentLikes")
                .doc(commentId)
                .collection("users")
                .doc(currentUser.uid)
                .set({ liked: true });

              const commentLikesRef = db.collection("commentLikes").doc(commentId);
              await db.runTransaction(async (transaction) => {
                const docSnap = await transaction.get(commentLikesRef);
                if (!docSnap.exists) {
                  transaction.set(commentLikesRef, { count: 1 });
                } else {
                  const newCount = (docSnap.data().count || 0) + 1;
                  transaction.update(commentLikesRef, { count: newCount });
                }
              });

              const newCountDoc = await db.collection("commentLikes").doc(commentId).get();
              commentLikeBtn.textContent = `❤️ Like Comment (${newCountDoc.data().count || 0})`;
            } catch (err) {
              console.error("Error liking comment:", err);
              showMessageBox("Failed to like the comment.");
            }
          };

          (async () => {
            try {
              const commentLikesDoc = await db.collection("commentLikes").doc(commentId).get();
              const likesCount = commentLikesDoc.exists && commentLikesDoc.data().count ? commentLikesDoc.data().count : 0;
              commentLikeBtn.textContent = `❤️ Like Comment (${likesCount})`;
            } catch {
              commentLikeBtn.textContent = `❤️ Like Comment (0)`;
            }
          })();

          commentDiv.innerHTML = `
            <strong>${escapeHtml(data.name)}</strong><br />
            <p>${escapeHtml(data.comment)}</p>
            <small>${data.timestamp ? new Date(data.timestamp.toDate()).toLocaleString() : ""}</small>
            <br />
          `;
          commentDiv.appendChild(commentLikeBtn);
          commentsList.appendChild(commentDiv);
        });
      } catch (error) {
        console.error("Error loading comments:", error);
        commentsList.textContent = "Failed to load comments.";
      }
    }

    commentForm.onsubmit = async (e) => {
      e.preventDefault();

      const name = document.getElementById("name").value.trim();
      const comment = document.getElementById("comment").value.trim();

      if (!name || !comment) {
        showMessageBox("Please fill out both fields.");
        return;
      }

      try {
        await db.collection("comments").add({
          name,
          comment,
          timestamp: firebase.firestore.FieldValue.serverTimestamp(),
        });
        commentForm.reset();
        loadComments();
      } catch (error) {
        console.error("Error posting comment:", error);
        showMessageBox("Failed to post comment.");
      }
    };

    starsContainer.addEventListener("click", async (event) => {
      if (!currentUser) {
        showMessageBox("You need to be logged in to rate the article.");
        return;
      }

      const clickedStar = event.target.closest(".star");
      if (!clickedStar) return;

      const ratingValue = parseInt(clickedStar.dataset.value, 10);
      const userRatingRef = db.collection("ratings").doc(currentUser.uid);

      try {
        await userRatingRef.set({ rating: ratingValue });
        showStarRating(ratingValue);
        ratingResult.textContent = `You rated this article ${ratingValue} star${ratingValue > 1 ? "s" : ""}.`;
      } catch (error) {
        console.error("Error submitting rating:", error);
        showMessageBox("Failed to submit rating.");
      }
    });

    async function loadUserRating() {
      if (!currentUser) {
        showStarRating(0);
        ratingResult.textContent = "";
        return;
      }
      try {
        const userRatingDoc = await db.collection("ratings").doc(currentUser.uid).get();
        if (userRatingDoc.exists) {
          const ratingValue = userRatingDoc.data().rating;
          showStarRating(ratingValue);
          ratingResult.textContent = `You rated this article ${ratingValue} star${ratingValue > 1 ? "s" : ""}.`;
        } else {
          showStarRating(0);
          ratingResult.textContent = "";
        }
      } catch (error) {
        console.error("Error loading rating:", error);
      }
    }

    function showStarRating(value) {
      const stars = document.querySelectorAll(".star");
      stars.forEach((star) => {
        const starValue = parseInt(star.dataset.value, 10);
        star.style.color = starValue <= value ? "gold" : "lightgray";
      });
    }

    // Custom message box function to replace alert()
    function showMessageBox(message) {
      const messageBox = document.createElement('div');
      messageBox.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        z-index: 1000;
        text-align: center;
        font-family: 'Montserrat', sans-serif;
        font-size: 1.1rem;
        color: #333;
        max-width: 80%;
        min-width: 250px;
      `;
      messageBox.innerHTML = `
        <p>${message}</p>
        <button style="
          background-color: #2ECC71;
          color: white;
          border: none;
          padding: 8px 15px;
          border-radius: 5px;
          cursor: pointer;
          margin-top: 15px;
          font-weight: bold;
        ">OK</button>
      `;
      document.body.appendChild(messageBox);

      messageBox.querySelector('button').onclick = () => {
        document.body.removeChild(messageBox);
      };
    }
  </script>
</body>
</html>